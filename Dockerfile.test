# Neo C++ Test Environment Docker Image
FROM ubuntu:22.04

# Prevent interactive prompts during package installation
ENV DEBIAN_FRONTEND=noninteractive

# Install build essentials and dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    cmake \
    git \
    wget \
    curl \
    libboost-all-dev \
    libssl-dev \
    nlohmann-json3-dev \
    libspdlog-dev \
    libgtest-dev \
    libgmock-dev \
    pkg-config \
    && rm -rf /var/lib/apt/lists/*

# Build and install Google Test
RUN cd /usr/src/googletest && \
    cmake . && \
    make && \
    cp lib/*.a /usr/lib

# Set working directory
WORKDIR /neo-cpp

# Copy the project files
COPY . .

# Create build directory
RUN mkdir -p build

# Build the tests
WORKDIR /neo-cpp/build
RUN cmake .. -DCMAKE_BUILD_TYPE=Debug && \
    make -j$(nproc)

# Set the test runner as the default command
CMD ["ctest", "--verbose"]