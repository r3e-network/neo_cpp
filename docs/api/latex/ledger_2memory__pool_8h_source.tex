\doxysection{memory\+\_\+pool.\+h}
\hypertarget{ledger_2memory__pool_8h_source}{}\label{ledger_2memory__pool_8h_source}\index{include/neo/ledger/memory\_pool.h@{include/neo/ledger/memory\_pool.h}}
\mbox{\hyperlink{ledger_2memory__pool_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{uint256_8h}{neo/io/uint256.h}}>}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{event__system_8h}{neo/ledger/event\_system.h}}>}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{pool__item_8h}{neo/ledger/pool\_item.h}}>}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{neo3__transaction_8h}{neo/network/p2p/payloads/neo3\_transaction.h}}>}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <functional>}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <mutex>}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <set>}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <shared\_mutex>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <unordered\_map>}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceneo_1_1ledger}{neo::ledger}}}
\DoxyCodeLine{00016\ \{}
\DoxyCodeLine{00021\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_aa0b8a407d5bdeaa18011900bdc602ab2}{MemoryPool}}}
\DoxyCodeLine{00022\ \{}
\DoxyCodeLine{00023\ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00024\ \ \ \ \ \textcolor{keyword}{mutable}\ std::shared\_mutex\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_a70d3c5862606f94ec662a8138a02a876}{mutex\_}};}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{comment}{//\ Main\ transaction\ pools\ (matches\ C\#\ Neo\ architecture)}}
\DoxyCodeLine{00027\ \ \ \ \ std::unordered\_map<io::UInt256,\ PoolItem>\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_a7ce47136e02d16aa570b512bddb3290d}{unsorted\_transactions\_}};\ \ \ \ \textcolor{comment}{//\ Dictionary<UInt256,\ PoolItem>}}
\DoxyCodeLine{00028\ \ \ \ \ std::set<PoolItem>\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_a4d07059eebbc20be6bdd70de2bd8a4df}{sorted\_transactions\_}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ SortedSet<PoolItem>}}
\DoxyCodeLine{00029\ \ \ \ \ std::unordered\_map<io::UInt256,\ PoolItem>\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_a678f5e520a57cda8ef573182641f8e38}{unverified\_transactions\_}};\ \ \textcolor{comment}{//\ Dictionary<UInt256,\ PoolItem>}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_ade1212db0fbb88c641bc6e30df6ea7dc}{max\_capacity\_}};}
\DoxyCodeLine{00032\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_a0b49451f7cd2f923272422358b31d2e1}{max\_unverified\_capacity\_}};}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{comment}{//\ Transaction\ verification\ function}}
\DoxyCodeLine{00035\ \ \ \ \ std::function<bool(\textcolor{keyword}{const}\ \mbox{\hyperlink{classneo_1_1network_1_1p2p_1_1payloads_1_1_neo3_transaction}{network::p2p::payloads::Neo3Transaction}}\&)>\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_a56f2a250a68abca79d4180a2173187c5}{verifier\_}};}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{comment}{//\ Note:\ Event\ handlers\ moved\ to\ static\ event\ system\ for\ C\#\ compatibility}}
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{comment}{//\ Events\ are\ now\ fired\ through\ MemoryPoolEvents\ static\ class}}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_aa0b8a407d5bdeaa18011900bdc602ab2}{MemoryPool}}(\textcolor{keywordtype}{size\_t}\ max\_capacity\ =\ 50000,\ \textcolor{keywordtype}{size\_t}\ max\_unverified\_capacity\ =\ 5000);}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_a77c4865ca8ec454cb8cfc0365ef11e33}{SetVerifier}}(std::function<\textcolor{keywordtype}{bool}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classneo_1_1network_1_1p2p_1_1payloads_1_1_neo3_transaction}{network::p2p::payloads::Neo3Transaction}}\&)>\ verifier);}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_a8acd5fbd5e1176b2f60326db3dd2700e}{TryAdd}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classneo_1_1network_1_1p2p_1_1payloads_1_1_neo3_transaction}{network::p2p::payloads::Neo3Transaction}}\&\ transaction);}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_ac9fa7ded226bb6af1642bcab36fd3e55}{Remove}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classneo_1_1io_1_1_u_int256}{io::UInt256}}\&\ hash);}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_a4ccd01c28bde227c52a896e1b62bf6f8}{Contains}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classneo_1_1io_1_1_u_int256}{io::UInt256}}\&\ hash)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classneo_1_1network_1_1p2p_1_1payloads_1_1_neo3_transaction}{network::p2p::payloads::Neo3Transaction}}*\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_af7edd7c514349488b0fc9dd28cf01a7c}{GetTransaction}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classneo_1_1io_1_1_u_int256}{io::UInt256}}\&\ hash)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00085\ \ \ \ \ std::vector<network::p2p::payloads::Neo3Transaction>\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_a50fa6c1ab28cbac45865c09733fe7afb}{GetSortedTransactions}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00091\ \ \ \ \ std::vector<network::p2p::payloads::Neo3Transaction>\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_adef06b9c3d1793f92fd698c21e78b9b3}{GetUnverifiedTransactions}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00098\ \ \ \ \ std::vector<network::p2p::payloads::Neo3Transaction>\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_a8c3919f6949bb3b318ff54984335f7b1}{GetTransactionsForBlock}}(\textcolor{keywordtype}{size\_t}\ max\_count)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_a88a793d76261750843cbecb8ac63ea9e}{GetSize}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_a6a4387544c230214141a40815373b766}{GetUnverifiedSize}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_af257d0447e032f9231bf96165f6262a5}{IsFull}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_a6dcbc665e86eeb1d456040e5d0704b7b}{Clear}}();}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structneo_1_1ledger_1_1_memory_pool_1_1_stats}{Stats}}}
\DoxyCodeLine{00128\ \ \ \ \ \{}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{structneo_1_1ledger_1_1_memory_pool_1_1_stats_af6dc7b67201d7016990e42870d31e022}{verified\_transaction\_count}};}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{structneo_1_1ledger_1_1_memory_pool_1_1_stats_ae7707cdf20058a18862e8d77941b8ffd}{unverified\_transaction\_count}};}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{structneo_1_1ledger_1_1_memory_pool_1_1_stats_ac5beb9c6fcac05e597692f25e59a10df}{total\_size\_bytes}};}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{structneo_1_1ledger_1_1_memory_pool_1_1_stats_a10e7e1516e55fe6c54dddc4f2072863b}{max\_capacity}};}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{structneo_1_1ledger_1_1_memory_pool_1_1_stats_ad2d23c09e3915d3bfeed65c24fa94fab}{max\_unverified\_capacity}};}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{structneo_1_1ledger_1_1_memory_pool_1_1_stats_aaaef681a7885e570bac5d7d04c7ba57e}{average\_fee\_per\_byte}};}
\DoxyCodeLine{00135\ \ \ \ \ \};}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \ \ \mbox{\hyperlink{structneo_1_1ledger_1_1_memory_pool_1_1_stats}{Stats}}\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_aaa03f698f60f4bf4e18f2edbf8181ed3}{GetStatistics}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_ad9293ef9f65acd08758c3aa77daddff2}{ReverifyTransactions}}(\textcolor{keywordtype}{size\_t}\ max\_count\ =\ 10);}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_a5b87c94d331bfbc4b9639c8e984e7b48}{EvictLowestPriority}}();}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_a184cde2e991543c861ed3a28e6543ad4}{EvictLowestPriorityUnverified}}();}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_ac9ec58c6dc2d6d4b60f4e34c50a06504}{CalculatePriority}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classneo_1_1network_1_1p2p_1_1payloads_1_1_neo3_transaction}{network::p2p::payloads::Neo3Transaction}}\&\ tx)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00173\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_a4ade8e8764b62a53f2bc7e8ca565dade}{MoveToVerified}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classneo_1_1ledger_1_1_pool_item}{PoolItem}}\&\ item);}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00179\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_a6183364cf2498cb88ee35c8b740883e2}{FireTransactionAddedEvent}}(std::shared\_ptr<network::p2p::payloads::Neo3Transaction>\ transaction);}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classneo_1_1ledger_1_1_memory_pool_a0ca1718792d926fba9f7636a6915fcb0}{FireTransactionRemovedEvent}}(std::shared\_ptr<network::p2p::payloads::Neo3Transaction>\ transaction,}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structneo_1_1ledger_1_1_transaction_removed_event_args_a377a2407688a727ef1cc0995b36ad8bd}{TransactionRemovedEventArgs::Reason}}\ reason);}
\DoxyCodeLine{00188\ \};}
\DoxyCodeLine{00189\ \}\ \ \textcolor{comment}{//\ namespace\ neo::ledger}}

\end{DoxyCode}
